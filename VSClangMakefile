EXTRA_CFLAGS=

CFLAGS=/O2 /MD /DCPRINTF_BUILDING /D_CRT_SECURE_NO_WARNINGS $(EXTRA_CFLAGS)

!if "$(SHARED)" == "yes"
LIB_FILES=cprintf.lib cprintf.dll
!else
LIB_FILES=cprintf_s.lib
!endif

all: $(LIB_FILES)

cprintf.lib cprintf.dll:
	llvm-rc.exe /n /fo cprintf_dll.res cprintf.rc
	clang-cl.exe /LD /DCPRINTF_DLL $(CFLAGS) /Fe"cprintf.dll" cprintf.c cprintf_dll.res

cprintf_s.lib: cprintf.obj
	llvm-lib.exe /OUT:cprintf_s.lib $?

cprintf.obj: cprintf.c
	clang-cl.exe $(CFLAGS) /c %s